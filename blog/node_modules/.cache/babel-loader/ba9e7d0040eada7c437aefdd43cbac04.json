{"remainingRequest":"C:\\Users\\dell\\Desktop\\新建文件夹 (2)\\blog\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\dell\\Desktop\\新建文件夹 (2)\\blog\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\dell\\Desktop\\新建文件夹 (2)\\blog\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\dell\\Desktop\\新建文件夹 (2)\\blog\\src\\components\\Comment\\Comment.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\dell\\Desktop\\新建文件夹 (2)\\blog\\src\\components\\Comment\\Comment.vue","mtime":1577527185791},{"path":"C:\\Users\\dell\\Desktop\\新建文件夹 (2)\\blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1577158444718},{"path":"C:\\Users\\dell\\Desktop\\新建文件夹 (2)\\blog\\node_modules\\babel-loader\\lib\\index.js","mtime":1577158456643},{"path":"C:\\Users\\dell\\Desktop\\新建文件夹 (2)\\blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1577158444718},{"path":"C:\\Users\\dell\\Desktop\\新建文件夹 (2)\\blog\\node_modules\\vue-loader\\lib\\index.js","mtime":1577158454493}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.regexp.match\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { ArticleComment, OtherComment, setArticleComment, setOuthComment } from \"../../utils/serve.js\";\nimport appdata from \"../../static/emot.json\";\nexport default {\n  data: function data() {\n    //选项 / 数据\n    return {\n      respondBox: '',\n      //评论表单\n      listDom: '',\n      //评论列表\n      tmsgBox: '',\n      //总评论盒子\n      isRespond: false,\n      textarea: '',\n      //文本框输入内容\n      pBody: true,\n      //表情打开控制\n      commentList: '',\n      //评论列表数据\n      pageId: 0,\n      //当前第几页\n      aid: 0,\n      //文章id\n      hasMore: true,\n      haslogin: false,\n      userId: '',\n      //用户id\n      leaveId: 0,\n      //回复评论的当前的commentId\n      leavePid: '',\n      //赞赏等其他模块的分类id\n      pid: '',\n      //回复评论的一级commentId\n      sendTip: '发送~',\n      OwOlist: appdata\n    };\n  },\n  methods: {\n    //事件处理器\n    //选择表情包\n    choseEmoji: function choseEmoji(inner) {\n      this.textarea += '[' + inner + ']';\n    },\n    getImgUrl: function getImgUrl(icon) {\n      return require(\"@/static/emot/\" + icon);\n    },\n    analyzeEmoji: function analyzeEmoji(cont) {\n      //编译表情替换成图片展示出来\n      var pattern1 = /\\[[\\u4e00-\\u9fa5]+\\]/g;\n      var pattern2 = /\\[[\\u4e00-\\u9fa5]+\\]/;\n      var content = cont.match(pattern1);\n      var str = cont;\n\n      if (content) {\n        for (var i = 0; i < content.length; i++) {\n          for (var j = 0; j < this.OwOlist.length; j++) {\n            if (\"[\" + this.OwOlist[j].title + \"]\" == content[i]) {\n              var src = this.OwOlist[j].url;\n              break;\n            }\n          }\n\n          str = str.replace(pattern2, '<img src=\"static/emot/' + src + '\"/>');\n        } // console.log(str);\n\n      }\n\n      return str;\n    },\n    //发送留言\n    sendMsg: function sendMsg() {\n      //留言\n      var that = this;\n\n      if (that.textarea) {\n        that.sendTip = '咻~~';\n\n        if (that.leaveId == 0) {\n          //   console.log(that.textarea,that.userId,that.aid,that.leavePid,that.pid);\n          setArticleComment(that.textarea, that.userId, that.aid, that.leavePid, that.pid, function (msg) {\n            //   console.log(msg);\n            that.textarea = '';\n            that.routeChange();\n            that.removeRespond();\n            var timer02 = setTimeout(function () {\n              that.sendTip = '发送~';\n              clearTimeout(timer02);\n            }, 1000);\n          });\n        } else {\n          //其他模块留言回复\n          setOuthComment(that.textarea, that.userId, that.aid, that.leaveId, that.leavePid, that.pid, function (msg) {\n            //   console.log(msg);\n            that.textarea = '';\n            that.removeRespond();\n            that.routeChange();\n          });\n        }\n      } else {\n        that.sendTip = '内容不能为空~';\n        var timer = setTimeout(function () {\n          that.sendTip = '发送~';\n          clearTimeout(timer);\n        }, 3000);\n      }\n    },\n    respondMsg: function respondMsg(leavePid, pid) {\n      //回复留言\n      // console.log(leavePid,pid);\n      var that = this;\n\n      if (localStorage.getItem('userInfo')) {\n        var dom = event.currentTarget;\n        dom = dom.parentNode;\n        this.isRespond = true;\n        this.leavePid = leavePid;\n        this.pid = pid;\n        dom.appendChild(this.$refs.respondBox);\n      } else {\n        that.$confirm('登录后即可点赞和收藏，是否前往登录页面?', '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          //确定，跳转至登录页面\n          //储存当前页面路径，登录成功后跳回来\n          localStorage.setItem('logUrl', that.$route.fullPath);\n          that.$router.push({\n            path: '/Login?login=1'\n          });\n        }).catch(function () {});\n      }\n    },\n    removeRespond: function removeRespond() {\n      //取消回复留言\n      this.isRespond = false;\n      this.$refs.tmsgBox.insertBefore(this.$refs.respondBox, this.$refs.listDom);\n    },\n    showCommentList: function showCommentList(initData) {\n      //评论列表\n      var that = this;\n      that.aid = that.$route.query.aid == undefined ? 1 : parseInt(that.$route.query.aid); //获取传参的aid\n      //判断当前用户是否登录\n\n      if (localStorage.getItem('userInfo')) {\n        that.haslogin = true;\n        that.userInfo = JSON.parse(localStorage.getItem('userInfo'));\n        that.userId = that.userInfo.userId; //   console.log(that.userInfo);\n      } else {\n        that.haslogin = false;\n      } //是否重新加载数据 还是累计加载\n\n\n      that.pageId = initData ? 0 : that.pageId; //公用设置数据方法\n\n      function setData(result) {\n        if (result.code == 1001) {\n          //查询数据\n          var msg = result.data; //   console.log(\"留言数据\",result.data);\n\n          if (msg.length > 0 && msg.length < 8) {\n            that.hasMore = false;\n          } else {\n            that.hasMore = true;\n          }\n\n          that.commentList = initData ? msg : that.commentList.concat(msg);\n          that.pageId = msg[msg.length - 1].comment_id;\n        } else {\n          //查询数据为空\n          that.hasMore = false;\n          that.commentList = initData ? [] : that.commentList;\n        }\n      }\n\n      if (that.$route.name == 'DetailShare') {\n        //文章列表的评论\n        that.leaveId = 0;\n        ArticleComment(that.aid, that.pageId, function (result) {\n          //查询列表\n          setData(result);\n        });\n      } else {\n        //其他评论\n        if (that.$route.name == 'Reward') {\n          //（1：赞赏 2：友情链接 3：留言板 4：关于我）\n          that.leaveId = 1;\n        } else if (that.$route.name == 'FriendsLink') {\n          that.leaveId = 2;\n        } else if (that.$route.name == 'Message') {\n          that.leaveId = 3;\n        } else if (that.$route.name == 'Aboutme') {\n          that.leaveId = 4;\n        }\n\n        OtherComment(that.leaveId, that.pageId, function (result) {\n          setData(result);\n        });\n      }\n    },\n    addMoreFun: function addMoreFun() {\n      //查看更多\n      this.showCommentList(false);\n    },\n    routeChange: function routeChange() {\n      //重新加载\n      var that = this;\n      this.showCommentList(true);\n    }\n  },\n  components: {//定义组件\n  },\n  watch: {// 如果路由有变化，会再次执行该方法\n    // '$route':'routeChange'\n  },\n  created: function created() {\n    //生命周期函数\n    // console.log(this.$route);\n    var that = this;\n    that.routeChange();\n  },\n  mounted: function mounted() {//页面加载完成后\n  }\n};",{"version":3,"sources":["Comment.vue"],"names":[],"mappings":"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","sourcesContent":["<!-- 留言评论模块 -->\n<template>\n    <div class=\"tmsgBox\"  ref=\"tmsgBox\">\n        <div class=\"tmsg-respond\"  ref=\"respondBox\">\n            <form class=\"\"  >\n                <el-input\n                  type=\"textarea\"\n                  :rows=\"2\"\n                  placeholder=\"说点什么呢``\"\n                  v-model=\"textarea\">\n                </el-input>\n                <div :class=\"pBody?'OwO':'OwO OwO-open'\">\n                    <div class=\"OwO-logo\" @click=\"pBody=!pBody\">\n                        <span>OwO表情</span>\n                    </div>\r\n\t\t\t\t\t<el-row class=\"tmsg-r-info\">\r\n\t\t\t\t\t    <el-col :span=\"24\" class=\"info-submit\">\r\n\t\t\t\t\t        <p class=\"tcolors-bg\" @click=\"sendMsg\">{{sendTip}}</p>\r\n\t\t\t\t\t    </el-col>\r\n\t\t\t\t\t</el-row>\r\n\t\t\t\t\t\n                    <div class=\"OwO-body\">\n                        <ul class=\"OwO-items OwO-items-show\">\n                            <li class=\"OwO-item\" v-for=\"(oitem,index) in OwOlist\" :key=\"'oitem'+index\" @click=\"choseEmoji(oitem.title)\">\n                              <!--  <img :src=\"'../../static/emot/'+oitem.url\" alt=\"\"> -->\r\n\t\t\t\t\t\t\t\t<img :src=\"getImgUrl(oitem.url) \" />\r\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n                \n            </form>\n        </div>\n        <div class=\"tmsg-comments\"  ref=\"listDom\">\n            <a href=\"#\" class=\"tmsg-comments-tip\">活捉 {{commentList?commentList.length:0}} 条</a>\n            <div class=\"tmsg-commentshow\">\n                <ul class=\"tmsg-commentlist\">\n                    <li class=\"tmsg-c-item\" v-for=\"(item,index) in commentList\" :key=\"'common'+index\">\n                        <article class=\"\">\n                            <header>\n                                <img  :src=\"item.avatar\"  :onerror=\"$store.state.errorImg\">\n                                <div class=\"i-name\">\n                                    {{item.username}}\n                                </div>\n                                <div class=\"i-class\">\n                                    {{item.label}}\n                                </div>\n                                <div class=\"i-time\">\n                                    <time>{{item.time}}</time>\n                                </div>\n                            </header>\n                            <section>\n                                <p v-html=\"analyzeEmoji(item.content)\">{{analyzeEmoji(item.content)}}</p>\n                                <div v-if=\"haslogin\" class=\"tmsg-replay\" @click=\"respondMsg(item.comment_id,item.comment_id)\">\n                                    回复\n                                </div>\n                            </section>\n                        </article>\n                        <ul v-show=\"item.ChildsSon\" class=\"tmsg-commentlist\" style=\"padding-left:60px;\">\n                            <li class=\"tmsg-c-item\" v-for=\"(citem,cindex) in item.ChildsSon\" :key=\"'citem'+cindex\">\n                                <article class=\"\">\n                                    <header>\n                                            <img :src=\"citem.avatar\"  :onerror=\"$store.state.errorImg\">\n                                            <div class=\"i-name\">\n                                                {{citem.username}} <span>回复</span> {{citem.reply_name}}\n                                            </div>\n                                            <div class=\"i-class\">\n                                                {{citem.label}}\n                                            </div>\n                                            <div class=\"i-time\">\n                                                <time>{{citem.time}}</time>\n                                            </div>\n                                    </header>\n                                    <section>\n                                        <p v-html=\"analyzeEmoji(citem.content)\">{{citem.content}}</p>\n                                        <div v-show=\"haslogin\" class=\"tmsg-replay\" @click=\"respondMsg(citem.comment_id,item.comment_id)\">\n                                            回复\n                                        </div>\n                                    </section>\n                                </article>\n                            </li>\n                        </ul>\n                    </li>\n\n                </ul>\n                <h1 v-show='hasMore' class=\"tcolors-bg\" @click=\"addMoreFun\" >查看更多</h1>\n                <h1 v-show='!hasMore' class=\"tcolors-bg\" >没有更多</h1>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\n    import {ArticleComment,OtherComment,setArticleComment,setOuthComment} from \"../../utils/serve.js\"\r\n\t\r\n\timport appdata from \"../../static/emot.json\"; \r\n    export default {\n        data() { //选项 / 数据\n            return {\n                respondBox:'',//评论表单\n                listDom:'',//评论列表\n                tmsgBox:'',//总评论盒子\n                isRespond:false,\n                textarea: '',//文本框输入内容\n                pBody:true,//表情打开控制\n                commentList:'',//评论列表数据\n                pageId:0,//当前第几页\n                aid:0,//文章id\n                hasMore:true,\n                haslogin:false,\n                userId:'',//用户id\n                leaveId:0,//回复评论的当前的commentId\n                leavePid:'',//赞赏等其他模块的分类id\n                pid:'',//回复评论的一级commentId\n                sendTip:'发送~',\n                OwOlist:appdata\n            }\n        },\r\n        methods: { //事件处理器\n          //选择表情包\n          choseEmoji:function(inner){\n              this.textarea +='[' + inner + ']';\n          },\r\n\t\t  \r\n\t\t  getImgUrl(icon){\r\n\t\t     return require(\"@/static/emot/\"+icon);\r\n\t\t  },\n          analyzeEmoji:function(cont){//编译表情替换成图片展示出来\n              var pattern1 = /\\[[\\u4e00-\\u9fa5]+\\]/g;\n                var pattern2 = /\\[[\\u4e00-\\u9fa5]+\\]/;\n                var content = cont.match(pattern1);\n                var str = cont;\n                if(content){\n                    for(var i=0;i<content.length;i++){\n                        for(var j=0;j<this.OwOlist.length;j++){\n                            if(\"[\"+this.OwOlist[j].title +\"]\" == content[i]){\n                                var src = this.OwOlist[j].url;\n                                break;\n                            }\n                        }\n                        str = str.replace(pattern2,'<img src=\"static/emot/'+src+'\"/>');\n                    }\n                    // console.log(str);\n                }\n                return str;\n          },\n          //发送留言\n          sendMsg:function(){//留言\n              var that = this;\n              if(that.textarea){\n                  that.sendTip = '咻~~';\n                  if(that.leaveId==0){\n                    //   console.log(that.textarea,that.userId,that.aid,that.leavePid,that.pid);\n                      setArticleComment(that.textarea,that.userId,that.aid,that.leavePid,that.pid,function(msg){\n                        //   console.log(msg);\n                          that.textarea = '';\n                          that.routeChange();\n                          that.removeRespond();\n                          var timer02 = setTimeout(function(){\n                              that.sendTip = '发送~';\n                              clearTimeout(timer02);\n                          },1000)\n                      })\n                  }else{\n                      //其他模块留言回复\n                      setOuthComment(that.textarea,that.userId,that.aid,that.leaveId,that.leavePid,that.pid,function(msg){\n                        //   console.log(msg);\n                          that.textarea = '';\n                          that.removeRespond();\n                        that.routeChange();\n                      })\n                  }\n              }else{\n                  that.sendTip = '内容不能为空~'\n                  var timer = setTimeout(function(){\n                      that.sendTip = '发送~';\n                      clearTimeout(timer);\n                  },3000)\n              }\n          },\n          respondMsg:function(leavePid,pid){//回复留言\n              // console.log(leavePid,pid);\n              var that = this;\n              if(localStorage.getItem('userInfo')){\n                  var dom = event.currentTarget;\n                  dom = dom.parentNode;\n                  this.isRespond = true;\n                  this.leavePid = leavePid;\n                  this.pid = pid;\n                  dom.appendChild(this.$refs.respondBox);\n              }else{\n                  that.$confirm('登录后即可点赞和收藏，是否前往登录页面?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                    }).then(() => {//确定，跳转至登录页面\n                        //储存当前页面路径，登录成功后跳回来\n                        localStorage.setItem('logUrl',that.$route.fullPath);\n                        that.$router.push({path:'/Login?login=1'});\n                   }).catch(() => {\n                   });\n              }\n          },\n          removeRespond:function(){//取消回复留言\n              this.isRespond = false;\n              this.$refs.tmsgBox.insertBefore(this.$refs.respondBox,this.$refs.listDom);\n          },\n          showCommentList: function(initData){//评论列表\n              var that = this;\n              that.aid = that.$route.query.aid==undefined?1:parseInt(that.$route.query.aid);//获取传参的aid\n              //判断当前用户是否登录\n              if(localStorage.getItem('userInfo')){\n                  that.haslogin = true;\n                  that.userInfo = JSON.parse(localStorage.getItem('userInfo'));\n                  that.userId = that.userInfo.userId;\n                //   console.log(that.userInfo);\n              }else{\n                  that.haslogin = false;\n              }\n              //是否重新加载数据 还是累计加载\n              that.pageId = initData ? 0 : that.pageId;\n              //公用设置数据方法\n              function setData(result){\n                  if(result.code==1001){//查询数据\n                      var msg = result.data;\n                    //   console.log(\"留言数据\",result.data);\n                      if(msg.length>0&&msg.length<8){\n                          that.hasMore = false\n                      }else{\n                          that.hasMore = true;\n                      }\n                      that.commentList = initData ? msg : that.commentList.concat(msg);\n                      that.pageId = msg[msg.length-1].comment_id;\n                  }else{//查询数据为空\n                      that.hasMore = false;\n                      that.commentList = initData ? [] : that.commentList\n                  }\n              }\n              if(that.$route.name=='DetailShare'){//文章列表的评论\n                  that.leaveId = 0;\n                  ArticleComment(that.aid,that.pageId,function(result){//查询列表\n                        setData(result);\n                  })\n              }else{//其他评论\n                  if(that.$route.name == 'Reward'){//（1：赞赏 2：友情链接 3：留言板 4：关于我）\n                      that.leaveId = 1\n                  }else if(that.$route.name == 'FriendsLink'){\n                      that.leaveId = 2\n                  }else if(that.$route.name == 'Message'){\n                      that.leaveId = 3\n                  }else if(that.$route.name == 'Aboutme'){\n                      that.leaveId = 4\n                  }\n                  OtherComment(that.leaveId,that.pageId,function(result){\n                      setData(result);\n                  })\n              }\n          },\n          addMoreFun:function(){//查看更多\n              this.showCommentList(false);\n          },\n          routeChange:function(){//重新加载\n              var that = this;\n              this.showCommentList(true);\n          }\n        },\n        components: { //定义组件\n        },\n        watch: {\n           // 如果路由有变化，会再次执行该方法\n           // '$route':'routeChange'\n         },\n        created() { //生命周期函数\n            // console.log(this.$route);\n            var that = this;\n            that.routeChange();\n        },\n        mounted(){//页面加载完成后\n        }\n    }\n</script>\n\n<style>\n@import url(\"Cindex.css\");\r\n.OwO{\r\n\t\r\n}\n</style>"],"sourceRoot":"src/components/Comment"}]}